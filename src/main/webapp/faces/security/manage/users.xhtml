<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="../../manage/crud.xhtml">
   <ui:define name="title">#{msgs.user_manage}</ui:define>

   <ui:define name="toolbar">
      <p:commandButton value="#{msgs.add}" icon="pi pi-plus" actionListener="#{userView.add}"
                       update=":dialogs:manage-entity-content" oncomplete="PF('manageEntityDialog').show()"
                       styleClass="ui-button-success" style="margin-right: .5rem">
         <p:resetInput target=":dialogs:manage-entity-content" />
      </p:commandButton>
      <p:commandButton id="delete-entities-button" value="#{userView.deleteButtonMessage}"
                       icon="pi pi-trash" actionListener="#{userView.deleteSelectedProducts}"
                       styleClass="ui-button-danger" disabled="#{!userView.hasSelectedProducts()}" update="@this">
         <p:confirm header="#{msgs.confirm}" message="#{msgs.user_confirm_delete_p}"
                    icon="pi pi-exclamation-triangle" />
      </p:commandButton>
   </ui:define>

   <ui:define name="datatable">
      <p:dataTable id="entities" widgetVar="entities" var="entity" value="#{userView.items}" stripedRows="true"
                   reflow="true" selection="#{userView.selectedItems}" editable="true"
                   rowKey="#{entity.id}" paginator="true" rows="10" rowSelectMode="add" paginatorPosition="bottom">

         <f:facet name="header">
            <div class="p-d-flex p-jc-between p-ai-center">
               <span style="font-weight: bold">#{msgs.users}</span>
               <div>
                        <span class="ui-picklist-filter-container ui-input-icon-left" style="padding-right: 1rem">
                            <i class="pi pi-search"/>
                            <p:inputText id="globalFilter" onkeyup="PF('entities').filter()" placeholder="#{msgs.search}"/>
                        </span>
                  <p:commandButton id="toggler" type="button" value="#{msgs.columns}" icon="pi pi-align-justify"/>
                  <p:columnToggler datasource="entities" trigger="toggler">
                     <p:ajax />
                  </p:columnToggler>
               </div>
            </div>
         </f:facet>

         <p:ajax event="rowSelect" update=":form:delete-entities-button" />
         <p:ajax event="rowUnselect" update=":form:delete-entities-button" />
         <p:ajax event="rowSelectCheckbox" update=":form:delete-entities-button" />
         <p:ajax event="rowUnselectCheckbox" update=":form:delete-entities-button" />
         <p:ajax event="toggleSelect" update=":form:delete-entities-button" />

         <p:column selectionMode="multiple" exportable="false" toggleable="false"/>

         <p:column headerText="#{msgs.username}" sortBy="#{entity.username}" filterBy="#{entity.username}">
            <h:outputText value="#{entity.username}"/>
         </p:column>
         <p:column headerText="#{msgs.role}" sortBy="#{entity.role.name}" filterBy="#{entity.role.name}">
            <h:outputText value="#{entity.role.name}"/>
         </p:column>

         <p:column headerText="#{msgs.options}" exportable="false" toggleable="false">
            <p:commandButton icon="pi pi-pencil" update=":dialogs:manage-entity-content"
                             oncomplete="PF('manageEntityDialog').show()"
                             styleClass="edit-button rounded-button ui-button-success" process="@this">
               <f:setPropertyActionListener value="#{entity}" target="#{userView.selectedItem}"/>
               <p:resetInput target=":dialogs:manage-entity-content"/>
            </p:commandButton>
            <p:commandButton icon="pi pi-trash" styleClass="ui-button-warning rounded-button"
                             process="@this" oncomplete="PF('deleteEntityDialog').show()">
               <f:setPropertyActionListener value="#{entity}" target="#{userView.selectedItem}"/>
            </p:commandButton>
         </p:column>

      </p:dataTable>
   </ui:define>

   <ui:define name="dialogs">
      <p:dialog header="#{msgs.user}" showEffect="fade" modal="true" widgetVar="manageEntityDialog"
                responsive="true">
         <p:outputPanel id="manage-entity-content" styleClass="ui-fluid">
            <p:outputPanel rendered="#{not empty userView.selectedItem}">
               <h:panelGrid columns="3" style="padding-bottom: 0.5rem">
                  <p:outputLabel for="username" value="#{msgs.username}" style="padding-right: 0.5rem"/>
                  <p:inputText id="username" required="true" value="#{userView.selectedItem.username}" disabled="#{!userView.newUser}"/>
                  <p:message for="username" display="tooltip"/>
                  <p:outputLabel for="role" value="#{msgs.role}" style="padding-right: 0.5rem"/>
                  <p:selectOneMenu id="role" required="true" value="#{userView.selectedRole}"
                                   hideNoSelectionOption="#{not empty userView.selectedItem.role.id}">
                     <p:ajax update="@this" process="@this"/>
                     <f:selectItem id="no_selection" noSelectionOption="true" itemLabel="#{msgs.role}" value="#{null}"/>
                     <f:selectItems value="#{userView.roles}" var="role" itemLabel="#{role.name}" itemValue="#{role.id}"/>
                  </p:selectOneMenu>
               </h:panelGrid>
               <p:message for="role" styleClass="p-col-align-center">
                  <p:autoUpdate/>
               </p:message>
            </p:outputPanel>
         </p:outputPanel>

         <f:facet name="footer">
            <div style="text-align: center">
               <p:commandButton value="#{msgs.save}" icon="pi pi-check" actionListener="#{userView.save}"
                                update="manage-entity-content" process="manage-entity-content @this"/>
               <p:commandButton value="#{msgs.cancel}" icon="pi pi-times" onclick="PF('manageEntityDialog').hide()"
                                class="ui-button-secondary" type="button" />
            </div>
         </f:facet>
      </p:dialog>

      <p:confirmDialog widgetVar="deleteEntityDialog" showEffect="fade" width="300"
                       message="#{msgs.user_confirm_delete}" header="#{msgs.confirm}" severity="warn">
         <p:commandButton value="#{msgs.yes}" icon="pi pi-check" actionListener="#{userView.delete}"
                          process="@this"
                          oncomplete="PF('deleteEntityDialog').hide()" />
         <p:commandButton value="#{msgs.no}" type="button" styleClass="ui-button-secondary" icon="pi pi-times"
                          onclick="PF('deleteEntityDialog').hide()" />
      </p:confirmDialog>

      <p:confirmDialog global="true" showEffect="fade" width="300">
         <p:commandButton value="#{msgs.yes}" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
         <p:commandButton value="#{msgs.no}" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"
                          icon="pi pi-times" />
      </p:confirmDialog>
   </ui:define>
</ui:composition>
</html>
